<!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="utf-8">
   <title>Build Radiator</title>
</head>
 <body bgcolor="black">
   <script src="jquery.js"></script>
   <script src="jquery.sound.js"></script>
   <script src="jquery.blink.js"></script>
   <script>
	function Radiator(url, status_id, failure_sound_file, delay)
	{
		this.delay = delay;
		this.url = url;
		this.status_id = status_id;
		this.failure_sound_file = failure_sound_file;

		function color_for(data)
		{
			if (data.result == "SUCCESS") return "green";
			if (data.result == null) return "orange";
			return "red";
		};

		this.populate = function(data)
		{
			color = color_for(data)
			$(this.status_id).css("background-color", color);
			$(this.status_id).html(data.fullDisplayName);
			if (color == "red" && color != this.last_status)
			{
				$(this.status_id).blink(
				{
					maxBlinks: 10,
					onBlink: function(){}, 
					blinkPeriod: 700,
					onMaxBlinks: function(){}
				});
				$.fn.soundPlay({url: this.failure_sound_file, playerId: 'embed_player', command: 'play'});
			}

			this.last_status = color;
			console.log("Rescheduling " + this.url);
			setTimeout(function(radiator)
					{
						return function() { radiator.update();};
					}(this), this.delay);
		};

		this.update = function()
		{
			$.ajax({
			  url: this.url + 'lastBuild/api/json?jsonp=?',
			  data: null,
			  success: function(radiator)
					{
						return function(data) { radiator.populate(data);};
					}(this),
			  dataType: "jsonp"
			});
		};

		this.init = function()
		{
			that = this;
			$(this.status_id).css({"color": "white", "fontSize": 160, "height": 400, "width": 1800});
			that.update();
		};
	};

	$(document).ready(function()
	{
		new Radiator('http://localhost:8080/job/FooBar%20Project/', '#project_status1', '1.mp3', 2000).init();
		new Radiator('http://localhost:8080/job/SecondBazProject/', '#project_status2', '1.mp3', 2000).init();
	});
   </script>
   <table>
	<tr>
		<td><div id="project_status1" align="center">Loading</div></td>
	</tr>
	<tr>
		<td><div id="project_status2" align="center">Loading</div></td>
	</tr>
   </table>
   <span id="sound_file_name" style="display:none"> &nbsp;</span>
 </body>
</html>

