<!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="utf-8">
   <title>Build Radiator</title>
</head>
 <body bgcolor="black">
   <script src="jquery.js"></script>
   <script src="jquery.sound.js"></script>
   <script src="jquery.blink.js"></script>
   <script>
	function Radiator(url, status_id, failure_sound_file)
	{
		this.url = url;
		this.status_id = status_id;
		this.failure_sound_file = failure_sound_file;

		function color_for(data)
		{
			if (data.result == "SUCCESS") return "green";
			if (data.result == null) return "orange";
			return "red";
		};

		this.update = function()
		{
			that = this;
			$.getJSON(that.url + 'lastBuild/api/json?jsonp=?',
			function(data)
			{
				color = color_for(data)
				$(that.status_id).css("background-color", color);
				$(that.status_id).html(data.fullDisplayName);
				if (color == "red" && color != that.last_status)
				{
					$.fn.soundPlay({url: that.failure_sound_file, playerId: 'embed_player', command: 'play'});
					$(that.status_id).blink(
					{
						maxBlinks: 10,
						blinkPeriod: 700,
						onBlink: function(){}, 
						onMaxBlinks: function(){}
					});
				}
				
				that.last_status = color;
				setTimeout(function(){that.update();}, 5000);
			}, "jsonp");
		};

		this.init = function()
		{
			$(this.status_id).css({"color": "white", "fontSize": 200, "height": 500});
			this.update();
		};
	};

	$(document).ready(function()
	{
		r = new Radiator('http://localhost:8080/job/FooBar%20Project/', '#project_status', '1.mp3')
		r.init();
	});
   </script>
   <div id="project_status" align="center">Loading</div>
   <span id="sound_file_name" style="display:none"> &nbsp;</span>
 </body>
</html>

